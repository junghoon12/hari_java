<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet" 
		integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" 
		crossorigin="anonymous">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"></script>
<script type="text/javascript">

	$(document).ready(function() {
		loadList();
	});
	
	function loadList() {
	
		$.ajax({
			url : "board_list.go",
			type : "get",
			dataType : "json",
			success : function(data) {
				let tab = "<table class='table table-bordered table-hover'>";
				tab += "<thead class='table-dark'>";
				tab += "<tr>";
				tab += "<th>글 No.</th> <th>글 제목</th> <th>조회수</th> <th>작성일자</th>";
				tab += "</tr>";
				tab += "</thead>";
				tab += "<tbody>";
				
				$.each(data, function(index, obj) {
					tab += "<tr>";
					tab += "<td>" + obj.board_no + "</td>";
					tab += "<td><a href='#' class='title-link' " +
							"data-no='"+ obj.board_no + "' " +
							"data-title='"+ obj.board_title + "' " +
							"data-writer='"+ obj.board_writer + "' " +
							"data-cont='"+ obj.board_cont + "' " +
							"data-pwd='"+ obj.board_pwd + "' " +
							"data-date='"+ obj.board_date + "'>" +
							obj.board_title + "</a></td>";
					tab += "<td>" + obj.board_hit + "</td>";
					tab += "<td>" + obj.board_date + "</td>";
					tab += "</tr>";
				});
				
				tab += "<tr>";
				tab += "<td colspan='4' class='text-center'>";
				tab += "<button class='btn btn-primary btn-sm' onclick='goForm()'>글쓰기</button>";
				tab += "</td>";
				tab == "</tr>";
				tab += "</tbody>";
				tab += "</table>";
				
				$("#view").html(tab);
					
				},
				error : function() {
					alert("데이터 통신 오류입니다.")
				}
				
		});
	}
	
	function goForm() {
		$("#view").hide();
		$("#write").show();
	}
	
	function goList() {
		$("#write").hide();
		$("#view").show();
	}
	
	
	function goInsert() {
		let data = $("#frm").serialize();
		// alert(data);
		
		$.ajax({
			url : "board_write_ok.go",
			type : "post",
			data : data,
			success : function() {
				loadList();
				goList();
			},
			error : function() {
				alert("데이터 통신 오류입니다.");
			}
		});
	}
	
	
	$(document).on("click", ".title-link", function() {
		let board_no = $(this).data("no");
		let board_pwd = $(this).data("pwd");
		let board_title = $(this).data("title");
		let board_writer = $(this).data("writer");
		let board_cont = $(this).data("cont");
		let board_date = $(this).data("date");
		
		$("#detailBoardNo").val(board_no);
		$("#detailBoardPwd").val(board_pwd);
		$("#detailTitle").text(board_title);
		$("#detailWriter").text(board_writer);
		$("#detailContent").val(board_cont);
		$("#detailDate").text(board_date);
		
		const modal = new bootstrap.Modal(document.getElementById("detailModal"));
		
		modal.show();
	});
	
	
	function openEditModal() {
		
		let boardNo = $("#detailBoardNo").val();
		let boardTitle = $("#detailTitle").text();
		let boardWriter = $("#detailWriter").text();
		let boardContent = $("#detailContent").val();
		
		$("#detailBoardNo").val(boardNo);
		$("#edit_writer").val(boardWriter);
		$("#edit_title").val(boardTitle);
		$("#edit_cont").val(boardContent);
		$("#edit_pwd").val("");
		
		// 상세 모달 창을 닫고 수정 모달 창을 열어야 한다.
		const detailModal = bootstrap.Modal.getInstance(document.getElementById("detailModal"));
		detailModal.hide();
		
		const editModal = new bootstrap.Modal(document.getElementById("editModal"));
		editModal.show();
	}
	
	

</script>
</head>
<body>

<div class="container mt-5">

	<h3 class="text-center mb-4">스프링 Board 테이블</h3>
	
	<%-- 전체 게시글 영역 --%>
	<div id="view"></div>
	
	<%-- 글쓰기 폼 영역 --%>
	<div id="write" class="card p-4" style="display: none;">
	   <form method="post" id="frm">
	      <div class="mb-3">
	         <label class="form-label">작성자</label>
	         <input type="text" name="board_writer" id="board_writer" class="form-control">
	      </div>
	      
	      <div class="mb-3">
	         <label class="form-label">글제목</label>
	         <input type="text" name="board_title" id="board_title" class="form-control">
	      </div>
	      
	      <div class="mb-3">
	         <label class="form-label">글내용</label>
	         <textarea name="board_cont" id="board_cont" class="form-control" rows="5"></textarea>
	      </div>
	      
	      <div class="mb-3">
	         <label class="form-label">비밀번호</label>
	         <input type="password" name="board_pwd" id="board_pwd" class="form-control">
	      </div>
	      
	      <div class="text-center">
	         <input type="button" class="btn btn-success btn-sm" onclick="goInsert()" value="글쓰기">
	         <input type="reset" class="btn btn-secondary btn-sm" id="clear" value="다시작성">
	         <input type="button" class="btn btn-outline-primary btn-sm" onclick="goList()" value="리스트">
	      </div>
	   </form>
	</div>
	
	
	<%-- 상세 보기 모달 --%>
	<div class="modal fade" id="detailModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
	  <div class="modal-dialog">
	    <div class="modal-content">
	      <div class="modal-header">
	        <h1 class="modal-title fs-5" id="exampleModalLabel">게시글 상세 정보</h1>
	        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
	      </div>
	      <div class="modal-body">
	        <input type="hidden" id="detailBoardNo">
	        <input type="hidden" id="detailBoardPwd">
	        <table class="table table-bordered">
	           <tr>
	              <th class="table-primary" style="width: 20%;">글 제목</th>
	              <td><span id="detailTitle"></span></td>
	           </tr>
	           
	           <tr>
	              <th class="table-primary">작성자</th>
	              <td><span id="detailWriter"></span></td>
	           </tr>
	           
	           <tr>
	              <th class="table-primary">글 내용</th>
	              <td><textarea rows="5" id="detailContent" readonly></textarea></td>
	           </tr>
	           
	           <tr>
	              <th class="table-primary">작성일자</th>
	              <td><span id="detailDate"></span></td>
	           </tr>
	        </table>
	      </div>
	      <div class="modal-footer">
	        <button type="button" class="btn btn-success btn-sm" onclick="openEditModal()">수정</button>
	        <button type="button" class="btn btn-danger btn-sm" onclick="openDelModal()">삭제</button>
	        <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">닫기</button>
	      </div>
	    </div>
	  </div>
	</div>
	
	
	<%-- 수정 폼 모달 --%>
	<div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
	  <div class="modal-dialog">
	    <div class="modal-content">
	      <div class="modal-header">
	        <h1 class="modal-title fs-5" id="exampleModalLabel">게시글 수정 폼 페이지</h1>
	        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
	      </div>
	      <div class="modal-body">
	        <input type="hidden" id="detailBoardNo">
	        <table class="table table-bordered">
	           <tr>
	              <th class="table-primary">작성자</th>
	              <td><input type="text" name="board_writer" id="edit_writer" class="form-control" readonly></td>
	           </tr>
	           
	           <tr>
	              <th class="table-primary">글 제목</th>
	              <td><input type="text" name="board_title" id="edit_title" class="form-control"></td>
	           </tr>
	           
	           <tr>
	              <th class="table-primary">글 내용</th>
	              <td><textarea name="board_cont" id="edit_cont" class="form-control" rows="4"></textarea></td>
	           </tr>
	           
	           <tr>
	              <th class="table-primary">글 비밀번호</th>
	              <td><input type="password" name="board_pwd" id="edit_pwd" class="form-control"></td>
	           </tr>
	           
	        </table>
	      </div>
	      <div class="modal-footer">
	        <button type="button" class="btn btn-success btn-sm" onclick="confirmEdit()">수정완료</button>
	        <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">닫기</button>
	      </div>
	    </div>
	  </div>
	</div>
	
</div>
	
</body>
</html>